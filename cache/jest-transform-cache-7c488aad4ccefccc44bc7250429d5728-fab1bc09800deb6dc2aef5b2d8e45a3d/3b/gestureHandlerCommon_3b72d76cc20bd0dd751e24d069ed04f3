78c42f7eeaeba66a3a23e1c787fa9446
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.filterConfig = filterConfig;
exports.findNodeHandle = findNodeHandle;
exports.scheduleFlushOperations = scheduleFlushOperations;
exports.baseGestureHandlerWithMonitorProps = exports.baseGestureHandlerProps = void 0;
var _reactNative = require("react-native");
var _handlersRegistry = require("./handlersRegistry");
var _utils = require("../utils");
var _RNGestureHandlerModule = _interopRequireDefault(require("../RNGestureHandlerModule"));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
var commonProps = ['id', 'enabled', 'shouldCancelWhenOutside', 'hitSlop', 'cancelsTouchesInView', 'userSelect'];
var componentInteractionProps = ['waitFor', 'simultaneousHandlers'];
var baseGestureHandlerProps = [].concat(commonProps, componentInteractionProps, ['onBegan', 'onFailed', 'onCancelled', 'onActivated', 'onEnded', 'onGestureEvent', 'onHandlerStateChange']);
exports.baseGestureHandlerProps = baseGestureHandlerProps;
var baseGestureHandlerWithMonitorProps = [].concat(commonProps, ['needsPointerData', 'manualActivation']);
exports.baseGestureHandlerWithMonitorProps = baseGestureHandlerWithMonitorProps;
function isConfigParam(param, name) {
  return param !== undefined && (param !== Object(param) || !('__isNative' in param)) && name !== 'onHandlerStateChange' && name !== 'onGestureEvent';
}
function filterConfig(props, validProps) {
  var defaults = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var filteredConfig = Object.assign({}, defaults);
  for (var key of validProps) {
    var value = props[key];
    if (isConfigParam(value, key)) {
      if (key === 'simultaneousHandlers' || key === 'waitFor') {
        value = transformIntoHandlerTags(props[key]);
      } else if (key === 'hitSlop' && typeof value !== 'object') {
        value = {
          top: value,
          left: value,
          bottom: value,
          right: value
        };
      }
      filteredConfig[key] = value;
    }
  }
  return filteredConfig;
}
function transformIntoHandlerTags(handlerIDs) {
  handlerIDs = (0, _utils.toArray)(handlerIDs);
  if (_reactNative.Platform.OS === 'web') {
    return handlerIDs.map(function (_ref) {
      var current = _ref.current;
      return current;
    }).filter(function (handle) {
      return handle;
    });
  }
  return handlerIDs.map(function (handlerID) {
    var _handlerID$current;
    return _handlersRegistry.handlerIDToTag[handlerID] || ((_handlerID$current = handlerID.current) === null || _handlerID$current === void 0 ? void 0 : _handlerID$current.handlerTag) || -1;
  }).filter(function (handlerTag) {
    return handlerTag > 0;
  });
}
function findNodeHandle(node) {
  if (_reactNative.Platform.OS === 'web') {
    return node;
  }
  return (0, _reactNative.findNodeHandle)(node);
}
var scheduledFlushOperationsId = null;
function scheduleFlushOperations() {
  if (scheduledFlushOperationsId === null) {
    scheduledFlushOperationsId = requestAnimationFrame(function () {
      _RNGestureHandlerModule.default.flushOperations();
      scheduledFlushOperationsId = null;
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUMsMEJBRUksR0FBRyxJQUZYO0FBSU8sU0FBU0MsdUJBQVQsR0FBbUM7RUFDeEMsSUFBSUQsMEJBQTBCLEtBQUssSUFBbkMsRUFBeUM7SUFDdkNBLDBCQUEwQixHQUFHRSxxQkFBcUIsQ0FBQyxZQUFNO01BQ3ZEQyxnQ0FBdUJDLGVBQXZCO01BRUFKLDBCQUEwQixHQUFHLElBQTdCO0lBQ0QsQ0FKaUQsQ0FBbEQ7RUFLRDtBQUNGIiwibmFtZXMiOlsiY29tbW9uUHJvcHMiLCJjb21wb25lbnRJbnRlcmFjdGlvblByb3BzIiwiYmFzZUdlc3R1cmVIYW5kbGVyUHJvcHMiLCJiYXNlR2VzdHVyZUhhbmRsZXJXaXRoTW9uaXRvclByb3BzIiwiaXNDb25maWdQYXJhbSIsInBhcmFtIiwibmFtZSIsInVuZGVmaW5lZCIsIk9iamVjdCIsImZpbHRlckNvbmZpZyIsInByb3BzIiwidmFsaWRQcm9wcyIsImRlZmF1bHRzIiwiZmlsdGVyZWRDb25maWciLCJrZXkiLCJ2YWx1ZSIsInRyYW5zZm9ybUludG9IYW5kbGVyVGFncyIsInRvcCIsImxlZnQiLCJib3R0b20iLCJyaWdodCIsImhhbmRsZXJJRHMiLCJQbGF0Zm9ybSIsIk9TIiwibWFwIiwiY3VycmVudCIsImZpbHRlciIsImhhbmRsZSIsImhhbmRsZXJJRCIsImhhbmRsZXJJRFRvVGFnIiwiX2hhbmRsZXJJRCRjdXJyZW50IiwiaGFuZGxlclRhZyIsImZpbmROb2RlSGFuZGxlIiwibm9kZSIsInNjaGVkdWxlZEZsdXNoT3BlcmF0aW9uc0lkIiwic2NoZWR1bGVGbHVzaE9wZXJhdGlvbnMiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJSTkdlc3R1cmVIYW5kbGVyTW9kdWxlIiwiZmx1c2hPcGVyYXRpb25zIl0sInNvdXJjZXMiOlsiZ2VzdHVyZUhhbmRsZXJDb21tb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gUHJldmlvdXMgdHlwZXMgZXhwb3J0ZWQgZ2VzdHVyZSBoYW5kbGVycyBhcyBjbGFzc2VzIHdoaWNoIGNyZWF0ZXMgYW4gaW50ZXJmYWNlIGFuZCB2YXJpYWJsZSwgYm90aCBuYW1lZCB0aGUgc2FtZSBhcyBjbGFzcy5cbi8vIFdpdGhvdXQgdGhvc2UgdHlwZXMsIHdlJ2QgaW50cm9kdWNlIGJyZWFraW5nIGNoYW5nZSwgZm9yY2luZyB1c2VycyB0byBwcmVmaXggZXZlcnkgaGFuZGxlciB0eXBlIHNwZWNpZmljYXRpb24gd2l0aCB0eXBlb2Zcbi8vIGUuZy4gUmVhY3QuY3JlYXRlUmVmPFRhcEdlc3R1cmVIYW5kbGVyPiAtPiBSZWFjdC5jcmVhdGVSZWY8dHlwZW9mIFRhcEdlc3R1cmVIYW5kbGVyPi5cbi8vIFNlZSBodHRwczovL3d3dy50eXBlc2NyaXB0bGFuZy5vcmcvZG9jcy9oYW5kYm9vay9jbGFzc2VzLmh0bWwjY29uc3RydWN0b3ItZnVuY3Rpb25zIGZvciByZWZlcmVuY2UuXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBQbGF0Zm9ybSwgZmluZE5vZGVIYW5kbGUgYXMgZmluZE5vZGVIYW5kbGVSTiB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5cbmltcG9ydCB7IFN0YXRlIH0gZnJvbSAnLi4vU3RhdGUnO1xuaW1wb3J0IHsgVG91Y2hFdmVudFR5cGUgfSBmcm9tICcuLi9Ub3VjaEV2ZW50VHlwZSc7XG5pbXBvcnQgeyBWYWx1ZU9mIH0gZnJvbSAnLi4vdHlwZVV0aWxzJztcbmltcG9ydCB7IGhhbmRsZXJJRFRvVGFnIH0gZnJvbSAnLi9oYW5kbGVyc1JlZ2lzdHJ5JztcbmltcG9ydCB7IHRvQXJyYXkgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgUk5HZXN0dXJlSGFuZGxlck1vZHVsZSBmcm9tICcuLi9STkdlc3R1cmVIYW5kbGVyTW9kdWxlJztcblxuY29uc3QgY29tbW9uUHJvcHMgPSBbXG4gICdpZCcsXG4gICdlbmFibGVkJyxcbiAgJ3Nob3VsZENhbmNlbFdoZW5PdXRzaWRlJyxcbiAgJ2hpdFNsb3AnLFxuICAnY2FuY2Vsc1RvdWNoZXNJblZpZXcnLFxuICAndXNlclNlbGVjdCcsXG5dIGFzIGNvbnN0O1xuXG5jb25zdCBjb21wb25lbnRJbnRlcmFjdGlvblByb3BzID0gWyd3YWl0Rm9yJywgJ3NpbXVsdGFuZW91c0hhbmRsZXJzJ10gYXMgY29uc3Q7XG5cbmV4cG9ydCBjb25zdCBiYXNlR2VzdHVyZUhhbmRsZXJQcm9wcyA9IFtcbiAgLi4uY29tbW9uUHJvcHMsXG4gIC4uLmNvbXBvbmVudEludGVyYWN0aW9uUHJvcHMsXG4gICdvbkJlZ2FuJyxcbiAgJ29uRmFpbGVkJyxcbiAgJ29uQ2FuY2VsbGVkJyxcbiAgJ29uQWN0aXZhdGVkJyxcbiAgJ29uRW5kZWQnLFxuICAnb25HZXN0dXJlRXZlbnQnLFxuICAnb25IYW5kbGVyU3RhdGVDaGFuZ2UnLFxuXSBhcyBjb25zdDtcblxuZXhwb3J0IGNvbnN0IGJhc2VHZXN0dXJlSGFuZGxlcldpdGhNb25pdG9yUHJvcHMgPSBbXG4gIC4uLmNvbW1vblByb3BzLFxuICAnbmVlZHNQb2ludGVyRGF0YScsXG4gICdtYW51YWxBY3RpdmF0aW9uJyxcbl07XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VzdHVyZUV2ZW50UGF5bG9hZCB7XG4gIGhhbmRsZXJUYWc6IG51bWJlcjtcbiAgbnVtYmVyT2ZQb2ludGVyczogbnVtYmVyO1xuICBzdGF0ZTogVmFsdWVPZjx0eXBlb2YgU3RhdGU+O1xufVxuZXhwb3J0IGludGVyZmFjZSBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQgZXh0ZW5kcyBHZXN0dXJlRXZlbnRQYXlsb2FkIHtcbiAgb2xkU3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbn1cblxuZXhwb3J0IHR5cGUgSGl0U2xvcCA9XG4gIHwgbnVtYmVyXG4gIHwgUGFydGlhbDxcbiAgICAgIFJlY29yZDxcbiAgICAgICAgJ2xlZnQnIHwgJ3JpZ2h0JyB8ICd0b3AnIHwgJ2JvdHRvbScgfCAndmVydGljYWwnIHwgJ2hvcml6b250YWwnLFxuICAgICAgICBudW1iZXJcbiAgICAgID5cbiAgICA+XG4gIHwgUmVjb3JkPCd3aWR0aCcgfCAnbGVmdCcsIG51bWJlcj5cbiAgfCBSZWNvcmQ8J3dpZHRoJyB8ICdyaWdodCcsIG51bWJlcj5cbiAgfCBSZWNvcmQ8J2hlaWdodCcgfCAndG9wJywgbnVtYmVyPlxuICB8IFJlY29yZDwnaGVpZ2h0JyB8ICdib3R0b20nLCBudW1iZXI+O1xuXG5leHBvcnQgdHlwZSBVc2VyU2VsZWN0ID0gJ25vbmUnIHwgJ2F1dG8nIHwgJ3RleHQnO1xuXG4vL1RPRE8oVFMpIGV2ZW50cyBpbiBoYW5kbGVyc1xuXG5leHBvcnQgaW50ZXJmYWNlIEdlc3R1cmVFdmVudDxFeHRyYUV2ZW50UGF5bG9hZFQgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICBuYXRpdmVFdmVudDogUmVhZG9ubHk8R2VzdHVyZUV2ZW50UGF5bG9hZCAmIEV4dHJhRXZlbnRQYXlsb2FkVD47XG59XG5leHBvcnQgaW50ZXJmYWNlIEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50PFxuICBFeHRyYUV2ZW50UGF5bG9hZFQgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPiB7XG4gIG5hdGl2ZUV2ZW50OiBSZWFkb25seTxIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFBheWxvYWQgJiBFeHRyYUV2ZW50UGF5bG9hZFQ+O1xufVxuXG5leHBvcnQgdHlwZSBUb3VjaERhdGEgPSB7XG4gIGlkOiBudW1iZXI7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xuICBhYnNvbHV0ZVg6IG51bWJlcjtcbiAgYWJzb2x1dGVZOiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBHZXN0dXJlVG91Y2hFdmVudCA9IHtcbiAgaGFuZGxlclRhZzogbnVtYmVyO1xuICBudW1iZXJPZlRvdWNoZXM6IG51bWJlcjtcbiAgc3RhdGU6IFZhbHVlT2Y8dHlwZW9mIFN0YXRlPjtcbiAgZXZlbnRUeXBlOiBUb3VjaEV2ZW50VHlwZTtcbiAgYWxsVG91Y2hlczogVG91Y2hEYXRhW107XG4gIGNoYW5nZWRUb3VjaGVzOiBUb3VjaERhdGFbXTtcbn07XG5cbmV4cG9ydCB0eXBlIEdlc3R1cmVVcGRhdGVFdmVudDxHZXN0dXJlRXZlbnRQYXlsb2FkVCA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+PiA9XG4gIEdlc3R1cmVFdmVudFBheWxvYWQgJiBHZXN0dXJlRXZlbnRQYXlsb2FkVDtcblxuZXhwb3J0IHR5cGUgR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnQ8XG4gIEdlc3R1cmVTdGF0ZUNoYW5nZUV2ZW50UGF5bG9hZFQgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuPiA9IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50UGF5bG9hZCAmIEdlc3R1cmVTdGF0ZUNoYW5nZUV2ZW50UGF5bG9hZFQ7XG5cbmV4cG9ydCB0eXBlIENvbW1vbkdlc3R1cmVDb25maWcgPSB7XG4gIGVuYWJsZWQ/OiBib29sZWFuO1xuICBzaG91bGRDYW5jZWxXaGVuT3V0c2lkZT86IGJvb2xlYW47XG4gIGhpdFNsb3A/OiBIaXRTbG9wO1xuICB1c2VyU2VsZWN0PzogVXNlclNlbGVjdDtcbn07XG5cbi8vIEV2ZW50cyBwYXlsb2FkcyBhcmUgdHlwZXMgaW5zdGVhZCBvZiBpbnRlcmZhY2VzIGR1ZSB0byBUUyBsaW1pdGF0aW9uLlxuLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMTUzMDAgZm9yIG1vcmUgaW5mby5cbmV4cG9ydCB0eXBlIEJhc2VHZXN0dXJlSGFuZGxlclByb3BzPFxuICBFeHRyYUV2ZW50UGF5bG9hZFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4+ID0gQ29tbW9uR2VzdHVyZUNvbmZpZyAmIHtcbiAgaWQ/OiBzdHJpbmc7XG4gIHdhaXRGb3I/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgc2ltdWx0YW5lb3VzSGFuZGxlcnM/OiBSZWFjdC5SZWY8dW5rbm93bj4gfCBSZWFjdC5SZWY8dW5rbm93bj5bXTtcbiAgdGVzdElEPzogc3RyaW5nO1xuICBjYW5jZWxzVG91Y2hlc0luVmlldz86IGJvb2xlYW47XG4gIC8vIFRPRE8oVFMpIC0gZml4IGV2ZW50IHR5cGVzXG4gIG9uQmVnYW4/OiAoZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50KSA9PiB2b2lkO1xuICBvbkZhaWxlZD86IChldmVudDogSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnQpID0+IHZvaWQ7XG4gIG9uQ2FuY2VsbGVkPzogKGV2ZW50OiBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudCkgPT4gdm9pZDtcbiAgb25BY3RpdmF0ZWQ/OiAoZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50KSA9PiB2b2lkO1xuICBvbkVuZGVkPzogKGV2ZW50OiBIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudCkgPT4gdm9pZDtcblxuICAvL1RPRE8oVFMpIGNvbnNpZGVyIHVzaW5nIE5hdGl2ZVN5bnRoZXRpY0V2ZW50XG4gIG9uR2VzdHVyZUV2ZW50PzogKGV2ZW50OiBHZXN0dXJlRXZlbnQ8RXh0cmFFdmVudFBheWxvYWRUPikgPT4gdm9pZDtcbiAgb25IYW5kbGVyU3RhdGVDaGFuZ2U/OiAoXG4gICAgZXZlbnQ6IEhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50PEV4dHJhRXZlbnRQYXlsb2FkVD5cbiAgKSA9PiB2b2lkO1xuICAvLyBpbXBsaWNpdCBgY2hpbGRyZW5gIHByb3AgaGFzIGJlZW4gcmVtb3ZlZCBpbiBAdHlwZXMvcmVhY3ReMTguMC4wXG4gIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlO1xufTtcblxuZnVuY3Rpb24gaXNDb25maWdQYXJhbShwYXJhbTogdW5rbm93biwgbmFtZTogc3RyaW5nKSB7XG4gIC8vIHBhcmFtICE9PSBPYmplY3QocGFyYW0pIHJldHVybnMgZmFsc2UgaWYgYHBhcmFtYCBpcyBhIGZ1bmN0aW9uXG4gIC8vIG9yIGFuIG9iamVjdCBhbmQgcmV0dXJucyB0cnVlIGlmIGBwYXJhbWAgaXMgbnVsbFxuICByZXR1cm4gKFxuICAgIHBhcmFtICE9PSB1bmRlZmluZWQgJiZcbiAgICAocGFyYW0gIT09IE9iamVjdChwYXJhbSkgfHxcbiAgICAgICEoJ19faXNOYXRpdmUnIGluIChwYXJhbSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikpKSAmJlxuICAgIG5hbWUgIT09ICdvbkhhbmRsZXJTdGF0ZUNoYW5nZScgJiZcbiAgICBuYW1lICE9PSAnb25HZXN0dXJlRXZlbnQnXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJDb25maWcoXG4gIHByb3BzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgdmFsaWRQcm9wczogc3RyaW5nW10sXG4gIGRlZmF1bHRzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG4pIHtcbiAgY29uc3QgZmlsdGVyZWRDb25maWcgPSB7IC4uLmRlZmF1bHRzIH07XG4gIGZvciAoY29uc3Qga2V5IG9mIHZhbGlkUHJvcHMpIHtcbiAgICBsZXQgdmFsdWUgPSBwcm9wc1trZXldO1xuICAgIGlmIChpc0NvbmZpZ1BhcmFtKHZhbHVlLCBrZXkpKSB7XG4gICAgICBpZiAoa2V5ID09PSAnc2ltdWx0YW5lb3VzSGFuZGxlcnMnIHx8IGtleSA9PT0gJ3dhaXRGb3InKSB7XG4gICAgICAgIHZhbHVlID0gdHJhbnNmb3JtSW50b0hhbmRsZXJUYWdzKHByb3BzW2tleV0pO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdoaXRTbG9wJyAmJiB0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHZhbHVlID0geyB0b3A6IHZhbHVlLCBsZWZ0OiB2YWx1ZSwgYm90dG9tOiB2YWx1ZSwgcmlnaHQ6IHZhbHVlIH07XG4gICAgICB9XG4gICAgICBmaWx0ZXJlZENvbmZpZ1trZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmaWx0ZXJlZENvbmZpZztcbn1cblxuZnVuY3Rpb24gdHJhbnNmb3JtSW50b0hhbmRsZXJUYWdzKGhhbmRsZXJJRHM6IGFueSkge1xuICBoYW5kbGVySURzID0gdG9BcnJheShoYW5kbGVySURzKTtcblxuICBpZiAoUGxhdGZvcm0uT1MgPT09ICd3ZWInKSB7XG4gICAgcmV0dXJuIGhhbmRsZXJJRHNcbiAgICAgIC5tYXAoKHsgY3VycmVudCB9OiB7IGN1cnJlbnQ6IGFueSB9KSA9PiBjdXJyZW50KVxuICAgICAgLmZpbHRlcigoaGFuZGxlOiBhbnkpID0+IGhhbmRsZSk7XG4gIH1cbiAgLy8gY29udmVydHMgaGFuZGxlciBzdHJpbmcgSURzIGludG8gdGhlaXIgbnVtZXJpYyB0YWdzXG4gIHJldHVybiBoYW5kbGVySURzXG4gICAgLm1hcChcbiAgICAgIChoYW5kbGVySUQ6IGFueSkgPT5cbiAgICAgICAgaGFuZGxlcklEVG9UYWdbaGFuZGxlcklEXSB8fCBoYW5kbGVySUQuY3VycmVudD8uaGFuZGxlclRhZyB8fCAtMVxuICAgIClcbiAgICAuZmlsdGVyKChoYW5kbGVyVGFnOiBudW1iZXIpID0+IGhhbmRsZXJUYWcgPiAwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmROb2RlSGFuZGxlKFxuICBub2RlOiBudWxsIHwgbnVtYmVyIHwgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PiB8IFJlYWN0LkNvbXBvbmVudENsYXNzPGFueT5cbik6IG51bGwgfCBudW1iZXIgfCBSZWFjdC5Db21wb25lbnQ8YW55LCBhbnk+IHwgUmVhY3QuQ29tcG9uZW50Q2xhc3M8YW55PiB7XG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuICByZXR1cm4gZmluZE5vZGVIYW5kbGVSTihub2RlKTtcbn1cblxubGV0IHNjaGVkdWxlZEZsdXNoT3BlcmF0aW9uc0lkOiBSZXR1cm5UeXBlPFxuICB0eXBlb2YgcmVxdWVzdEFuaW1hdGlvbkZyYW1lXG4+IHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBzY2hlZHVsZUZsdXNoT3BlcmF0aW9ucygpIHtcbiAgaWYgKHNjaGVkdWxlZEZsdXNoT3BlcmF0aW9uc0lkID09PSBudWxsKSB7XG4gICAgc2NoZWR1bGVkRmx1c2hPcGVyYXRpb25zSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgUk5HZXN0dXJlSGFuZGxlck1vZHVsZS5mbHVzaE9wZXJhdGlvbnMoKTtcblxuICAgICAgc2NoZWR1bGVkRmx1c2hPcGVyYXRpb25zSWQgPSBudWxsO1xuICAgIH0pO1xuICB9XG59XG4iXX0=